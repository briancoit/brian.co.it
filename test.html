<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Epic Milky Way - Three.js</title>
<style>
  body { margin: 0; overflow: hidden; background: #000; }
  canvas { display: block; }
</style>
</head>
<body>
<script type="module">
import * as THREE from 'https://esm.run/three@0.152.2/build/three.module.js';
import { OrbitControls } from 'https://esm.run/three@0.152.2/examples/jsm/controls/OrbitControls.js';

// Scene setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 10, 50);

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x000000);
document.body.appendChild(renderer.domElement);

// Orbit controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.1;

// Star layers
const starLayers = [];
function addStarLayer(count, minRadius, maxRadius, size) {
  const geometry = new THREE.BufferGeometry();
  const positions = new Float32Array(count*3);
  const colors = new Float32Array(count*3);
  for(let i=0;i<count;i++){
    const r = THREE.MathUtils.randFloat(minRadius,maxRadius);
    const theta = Math.random()*2*Math.PI;
    const phi = Math.random()*Math.PI;
    positions[i*3] = r * Math.sin(phi) * Math.cos(theta);
    positions[i*3+1] = r * Math.cos(phi);
    positions[i*3+2] = r * Math.sin(phi) * Math.sin(theta);
    const colorVal = 0.7 + Math.random()*0.3;
    colors[i*3] = colorVal;
    colors[i*3+1] = colorVal;
    colors[i*3+2] = colorVal;
  }
  geometry.setAttribute('position', new THREE.BufferAttribute(positions,3));
  geometry.setAttribute('color', new THREE.BufferAttribute(colors,3));
  const material = new THREE.PointsMaterial({
    size, vertexColors:true, blending:THREE.AdditiveBlending,
    transparent:true, depthWrite:false
  });
  const points = new THREE.Points(geometry, material);
  scene.add(points);
  starLayers.push(points);
}

// Three star layers for depth
addStarLayer(8000, 40, 70, 0.15); // core
addStarLayer(5000, 10, 40, 0.1);  // mid
addStarLayer(2000, 70, 100, 0.2); // distant

// Nebula glow
const loader = new THREE.TextureLoader();
loader.load('https://i.imgur.com/HE9yPbd.png', (texture)=>{
  const nebulaGeo = new THREE.SphereGeometry(50,64,64);
  const nebulaMat = new THREE.MeshBasicMaterial({
    map: texture, transparent:true, blending:THREE.AdditiveBlending,
    side:THREE.BackSide, opacity:0.7
  });
  const nebula = new THREE.Mesh(nebulaGeo, nebulaMat);
  scene.add(nebula);
});

// Galaxy sphere background
loader.load('https://i.imgur.com/rwG6wRm.jpg', (texture)=>{
  const geometry = new THREE.SphereGeometry(100, 64,64);
  const material = new THREE.MeshBasicMaterial({map:texture, side:THREE.BackSide});
  const galaxySphere = new THREE.Mesh(geometry, material);
  scene.add(galaxySphere);
});

// Planet with atmosphere
const planetRadius = 4;
const planetGeo = new THREE.SphereGeometry(planetRadius,64,64);
const planetMat = new THREE.MeshPhongMaterial({color:0x4060ff, shininess:30, specular:0xaaaaaa});
const planet = new THREE.Mesh(planetGeo, planetMat);
planet.position.set(-15,-5,20);
scene.add(planet);

// Atmosphere glow
const atmosphereGeo = new THREE.SphereGeometry(planetRadius*1.15,64,64);
const atmosphereMat = new THREE.ShaderMaterial({
  vertexShader:`
    varying vec3 vNormal;
    void main() {
      vNormal = normalize(normalMatrix * normal);
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
  `,
  fragmentShader:`
    varying vec3 vNormal;
    void main() {
      float intensity = pow(0.6 - dot(vNormal, vec3(0,0,1.0)), 3.0);
      gl_FragColor = vec4(0.3,0.5,1.0,1.0) * intensity;
    }
  `,
  blending:THREE.AdditiveBlending,
  side:THREE.BackSide,
  transparent:true,
  depthWrite:false
});
const atmosphere = new THREE.Mesh(atmosphereGeo, atmosphereMat);
atmosphere.position.copy(planet.position);
scene.add(atmosphere);

// Lighting
scene.add(new THREE.AmbientLight(0x404040,0.6));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(50,50,50);
scene.add(dirLight);

// Resize
window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// Animate
function animate(){
  requestAnimationFrame(animate);

  // Rotate star layers at different speeds & twinkle
  const time = Date.now() * 0.001;
  starLayers.forEach((layer,i)=>{
    layer.rotation.y += 0.0003 + i*0.0002;
    layer.material.opacity = 0.8 + 0.2 * Math.sin(time + i*5);
  });

  planet.rotation.y += 0.001;
  atmosphere.rotation.y += 0.0012;

  controls.update();
  renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
